<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Outpayce Checkout SDK – Basic</title>

  <!-- SDK 4.0.0 (giữ nguyên như bạn đang dùng). Nếu Amadeus cấp URL test khác, thay cho phù hợp -->
  <link
    rel="stylesheet"
    href="https://pdt.payment.amadeus.com/checkout/sdk/4.0.0/sdk.css"
    integrity="sha384-PxY0l2o4ZNHU96cDetNVSb5wJDrxX63KNcT60xxnPjxvx4/uxfFxysATJleJHaaQ"
    crossorigin="anonymous"
  />
  <script
    src="https://pdt.payment.amadeus.com/checkout/sdk/4.0.0/sdk-es2015.js"
    integrity="sha384-xvc3rZS/zWy8mL4Ykp6/+RNFY82Gcr0zGdxjhIbvCjwAx6zQHbdSDW6cywI63yiS"
    crossorigin="anonymous"
  ></script>

  <style>
    #pay-button{
      display:none;padding:12px 24px;font-size:16px;font-weight:600;
      border:2px solid #4CAF50;color:#fff;background:#4CAF50;border-radius:6px;cursor:pointer
    }
    #pay-button:hover{background:#fff;color:#4CAF50}
  </style>
</head>
<body>
  <div id="payment-form-container"></div>
  <button id="pay-button" type="button">Pay</button>

  <script>
    // Đọc tham số từ URL: ?ppid=...&env=test|pdt
    const params = new URLSearchParams(location.search);
    const ppid = params.get('ppid');                 // BẮT BUỘC: PPID/checkoutFormId
    const env  = (params.get('env') || 'pdt').toLowerCase(); // 'test' hoặc 'pdt'

    // Helper hiển thị lỗi sớm nếu thiếu cấu hình
    function showError(msg){
      console.error(msg);
      const p = document.createElement('p');
      p.style.color = 'red';
      p.textContent = msg;
      document.body.appendChild(p);
    }

    if (!ppid) showError('Missing ?ppid=<checkoutFormId> in URL');
    if (!window.AmadeusCheckout) showError('SDK not loaded');

    if (ppid && window.AmadeusCheckout){
      const checkout = new AmadeusCheckout({
        container: 'payment-form-container', // id của div
        ppid,                                 // PPID từ query
        environment: env,                     // 'test' (sandbox) hoặc 'pdt' (production)
        locale: 'en-GB',
        options: {}
      });

     checkout.onReady = function(mopsList, sessionTimeout) {
        // Called as soon as the SDK as retrieved the list of available method of payment
        console.log("onReady")
    };
    checkout.onChange = function(change) {
        // Called when there is a change on: the selected method, the fees, the card bin or the validity of the form
        //This method is deprecated and will be replaced by onPaymentMethodsChange
        console.log("onChange")
    };
    checkout.onPaymentMethodsChange = function(change) {
        // Called when there is a change on: the selected methods of payment, the fees, the cards bin or the validity of the form
        // replace the deprecated onChange method
        console.log("onPaymentMethodsChange")
    };
    checkout.onRedirectionNeeded = function(mopId, redirectionRequest) {
        // Called before the SDK redirects the user to an external page
        console.log("onRedirectionNeeded")
    }
    checkout.onSuccess = function(mainMopId, successData) {
        // Called when the payment is successful
        console.log("onSuccess")
    };
    checkout.onError = function(mopId, errorDetails) {
        // Called on failure or on error
        console.log("onError")
    };
    checkout.delegateServerCall = function(actionTokenList, delegationType) {
        // Called when there is a payment transaction that is delegated to calling application.
        // For standard integrations this callback can be ignored.
          console.log("delegateServerCall called with:", actionTokenList, delegationType);

        console.log("delegateServerCall")
    };

      checkout.start();

      document.getElementById('pay-button').addEventListener('click', function(){
        checkout.pay();
      });
    }
  </script>
</body>
</html>



